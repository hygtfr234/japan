<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>å››åœ‹å†’éšªæ—¥èªŒ V7.0</title>
    <link
      href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --maple-bg: #87ceeb;
      }
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        font-family: "M PLUS Rounded 1c", sans-serif;
        background-color: var(--maple-bg);
        /* èƒŒæ™¯åœ– */
        background-image: url("https://i.pinimg.com/originals/1e/86/82/1e8682d029094054a138c2084c83091e.jpg");
        background-size: cover;
        background-attachment: fixed;
        background-position: center bottom;
        margin: 0;
        padding: 8px;
        color: #333;
        padding-bottom: 60px;
      }
      .quest-window {
        max-width: 600px;
        margin: 5px auto;
        background: #fdfdfd;
        border: 2px solid #888;
        border-radius: 12px;
        box-shadow: 0 0 0 3px #555, 0 10px 20px rgba(0, 0, 0, 0.4);
        overflow: hidden;
      }
      .window-header {
        background: linear-gradient(to bottom, #4b6cb7, #182848);
        padding: 10px 15px;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 3px solid #333;
      }
      .header-icon {
        width: 40px;
        height: 40px;
        object-fit: contain;
        margin-right: 10px;
        filter: drop-shadow(2px 2px 0 rgba(0, 0, 0, 0.5));
        animation: bounce 2s infinite;
      }
      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }
      .tabs {
        display: flex;
        width: 100%;
        background: #e0e0e0;
        border-bottom: 2px solid #aaa;
      }
      .tab-btn {
        flex: 1;
        background: linear-gradient(to bottom, #f8f8f8, #dcdcdc);
        border-right: 1px solid #999;
        border-bottom: none;
        padding: 10px 0;
        cursor: pointer;
        font-weight: 800;
        color: #555;
        font-size: 16px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .tab-btn:last-child {
        border-right: none;
      }
      .tab-btn.active {
        background: #fff;
        color: #000;
        box-shadow: inset 0 -4px 0 #ffcc00;
      }
      .tab-sub {
        font-size: 11px;
        font-weight: normal;
        color: #666;
        margin-top: 2px;
      }
      .tab-btn.active .tab-sub {
        color: #000;
        font-weight: bold;
      }
      .content-area {
        background: #fff;
        padding: 15px;
        min-height: 480px;
      }
      .weather-panel {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border: 2px solid #1e88e5;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
      }
      .weather-loc {
        font-size: 15px;
        font-weight: 900;
        color: #1565c0;
      }
      .weather-detail {
        font-size: 12px;
        color: #0d47a1;
        margin-top: 4px;
        font-weight: bold;
      }
      .weather-right {
        text-align: right;
      }
      .weather-icon {
        font-size: 32px;
        display: block;
        margin-bottom: -5px;
      }
      .weather-temp {
        font-size: 26px;
        color: #d84315;
        font-weight: 900;
      }
      .weather-fallback-btn {
        display: inline-block;
        background: #fff;
        color: #1565c0;
        text-decoration: none;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
        margin-top: 5px;
        border: 1px solid #1565c0;
      }
      .sub-nav-container {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        background: #eee;
        padding: 5px;
        border-radius: 8px;
      }
      .sub-nav-btn {
        flex: 1;
        padding: 10px;
        border: 2px solid transparent;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        background: #ccc;
        color: #555;
      }
      .sub-nav-btn.active-main {
        background: #fff;
        border-color: #ffcc00;
        color: #333;
      }
      .sub-nav-btn.active-backup {
        background: #e6e6fa;
        border-color: #9370db;
        color: #4b0082;
      }
      .quest-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .quest-item {
        border-bottom: 1px dashed #ccc;
        padding: 15px 0;
      }
      .quest-item:last-child {
        border-bottom: none;
      }
      .quest-header {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }
      .quest-time {
        background: #333;
        color: #ffcc00;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 14px;
        font-weight: bold;
        margin-right: 10px;
        min-width: 60px;
        text-align: center;
      }
      .quest-title {
        font-size: 18px;
        font-weight: 800;
        color: #222;
        display: flex;
        align-items: center;
      }
      .event-icon-img {
        width: 28px;
        height: 28px;
        margin-left: 8px;
        object-fit: contain;
      }
      .quest-desc {
        font-size: 15px;
        color: #555;
        margin: 0 0 12px 0;
        line-height: 1.4;
        padding-left: 2px;
      }
      .btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        font-weight: bold;
        font-size: 15px;
        text-decoration: none;
        color: white;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        transition: 0.1s;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      .btn:active {
        transform: translateY(4px);
        box-shadow: none;
      }
      .btn-nav {
        background: linear-gradient(to bottom, #4facfe, #00f2fe);
      }
      .btn-info {
        background: linear-gradient(to bottom, #ffd200, #f7971e);
        color: #333;
        margin-left: 10px;
        width: auto;
        min-width: 80px;
      }
      .btn-hotel {
        background: linear-gradient(to bottom, #ff758c, #ff7eb3);
        font-size: 20px;
        padding: 18px;
        margin-top: 20px;
      }
      .npc-dialog {
        background: #fff8dc;
        border: 2px solid #daa520;
        border-radius: 12px;
        padding: 15px 15px 15px 65px;
        position: relative;
        margin-top: 25px;
        font-size: 14px;
        line-height: 1.6;
        color: #4a3b2a;
      }
      .npc-dialog::before {
        content: "";
        width: 50px;
        height: 50px;
        background-image: url("https://maplestory.io/api/gms/62/mob/1210102/render/move?center=true");
        background-size: contain;
        background-repeat: no-repeat;
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
      }
      .exp-bar-container {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 40px;
        background: #2b2b2b;
        border-top: 2px solid #555;
        display: flex;
        align-items: center;
        padding: 0 15px;
        z-index: 999;
      }
      .exp-track {
        flex: 1;
        height: 16px;
        background: #111;
        border-radius: 8px;
        overflow: hidden;
      }
      .exp-fill {
        height: 100%;
        background: linear-gradient(to bottom, #00ff00, #00cc00);
        width: 0%;
        transition: 0.5s;
      }
    </style>
  </head>
  <body>
    <div class="quest-window">
      <div class="window-header">
        <div style="display: flex; align-items: center">
          <!-- ã€åœ–ç‰‡ä½ç½® 1ã€‘æ¨™é¡Œåœ–ç‰‡ (è«‹åˆ°åº•ä¸‹ JavaScript å€æ›´æ›) -->
          <img id="headerIconImg" src="" class="header-icon" alt="icon" />
          <div style="font-size: 18px; text-shadow: 1px 1px 0 #000">
            ğŸ è³œåœ‹ç©å››åœ‹
          </div>
        </div>
        <div
          style="
            font-size: 12px;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
          "
        >
          Lv. 2026
        </div>
      </div>

      <!-- æ¨™ç±¤å°èˆª -->
      <div class="tabs">
        <div class="tab-btn active" onclick="loadDay(1)">
          D1<span class="tab-sub">é«˜æ¾</span>
        </div>
        <div class="tab-btn" onclick="loadDay(2)">
          D2<span class="tab-sub">å°è±†å³¶</span>
        </div>
        <div class="tab-btn" onclick="loadDay(3)">
          D3<span class="tab-sub">é‡‘åˆ€æ¯”ç¾…</span>
        </div>
        <div class="tab-btn" onclick="loadDay(4)">
          D4<span class="tab-sub">å€‰æ•·</span>
        </div>
        <div class="tab-btn" onclick="loadDay(5)">
          D5<span class="tab-sub">è¿”ç¨‹</span>
        </div>
        <div class="tab-btn" onclick="loadDay('info')">
          INFO<span class="tab-sub">ä½å®¿</span>
        </div>
      </div>

      <div class="content-area" id="mainContent"></div>
    </div>

    <div class="exp-bar-container">
      <span style="color: #ffcc00; font-weight: 900; margin-right: 10px"
        >EXP</span
      >
      <div class="exp-track"><div class="exp-fill" id="expFill"></div></div>
      <span
        style="color: white; font-size: 12px; margin-left: 10px"
        id="expText"
        >0%</span
      >
    </div>

    <script>
      // =========================================================
      // ğŸ¨ ã€åœ–ç‰‡æ§åˆ¶ä¸­å¿ƒã€‘ è«‹åœ¨é€™è£¡æ›´æ›æ‚¨çš„åœ–ç‰‡ç¶²å€
      // =========================================================

      // 1. æ¨™é¡Œåˆ—å·¦ä¸Šè§’çš„åœ–æ¡ˆ (é è¨­ï¼šç¶ æ°´éˆ)
      const HEADER_ICON_URL =
        "https://maplestory.io/api/gms/62/mob/1210100/render/move?center=true";

      // 2. è¡Œç¨‹å…§çš„å°åœ–ç¤º (å¯ä»¥åœ¨ itinerary è£¡ç”¨ 'iconName' å‘¼å«)
      const ICONS = {
        // é£›æ©Ÿ (é è¨­ï¼šè¯èˆª Logo) -> æ‚¨å¯ä»¥æŠŠå¼•è™Ÿå…§çš„ç¶²å€æ›æˆæ‚¨ä¸Šå‚³åˆ° Imgur çš„åœ–ç‰‡
        plane:
          "https://upload.wikimedia.org/wikipedia/zh/thumb/c/c3/China_Airlines_Logo_2015.svg/1200px-China_Airlines_Logo_2015.svg.png",

        // èˆ¹
        boat: "https://cdn-icons-png.flaticon.com/128/2942/2942544.png",

        // æ‚¨å¯ä»¥è‡ªå·±æ–°å¢ï¼Œä¾‹å¦‚è¡Œæç®± (åœ¨è¡Œç¨‹ä¸­åŠ å…¥ icon: 'luggage' å³å¯é¡¯ç¤º)
        luggage: "https://cdn-icons-png.flaticon.com/128/3076/3076134.png",
      };

      // è¨­å®šæ¨™é¡Œåœ–ç‰‡
      document.getElementById("headerIconImg").src = HEADER_ICON_URL;

      // =========================================================
      // ğŸ“… è¡Œç¨‹è³‡æ–™
      // =========================================================
      const itinerary = {
        1: {
          title: "Day 1ï½œæŠµé”é«˜æ¾",
          date: "1/23 (äº”)",
          location: "Takamatsu",
          lat: 34.3428,
          long: 134.0466,
          events: [
            // æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨äº† icon: 'plane'ï¼Œå®ƒæœƒå»ä¸Šé¢æŠ“è¯èˆªçš„åœ–
            {
              time: "10:20",
              title: "æŠµé”é«˜æ¾ç©ºæ¸¯",
              desc: "å…¥å¢ƒæ‰‹çºŒã€å–è»Š",
              lat: 34.2142,
              lng: 134.0157,
              icon: "plane",
            },
            {
              time: "12:00",
              title: "ç§Ÿè»Š & åˆé¤",
              desc: "æ¶®ä¹ƒè‘‰ (åƒé£½å‡ºç™¼)",
              lat: 34.2963,
              lng: 134.0441,
              link: "https://maps.app.goo.gl/KdNuojGtmtbTNwVn7",
            },
            {
              time: "13:30",
              title: "æ —æ—å…¬åœ’",
              desc: "ç±³å…¶æ—ä¸‰æ˜Ÿåº­åœ’ (2H)",
              lat: 34.3297,
              lng: 134.0444,
            },
            {
              time: "17:30",
              title: "å•†åº—è¡—æ•£ç­–",
              desc: "å…«å¤§æ¢å•†åº—è¡—è‡ªç”±é€›",
              lat: 34.3444,
              lng: 134.0522,
            },
            {
              time: "18:30",
              title: "Vent Buffet",
              desc: "æ™šé¤æ™‚å…‰",
              lat: 34.3512,
              lng: 134.056,
              link: "https://maps.app.goo.gl/uX7nC3x7z8x9",
            },
          ],
          note: "ç¬¬ä¸€å¤©è¼•é¬†é»ï¼Œé©æ‡‰å³é§•ã€‚",
        },
        2: {
          title: "Day 2ï½œå°è±†å³¶",
          date: "1/24 (å…­)",
          location: "Shodoshima",
          lat: 34.495,
          long: 134.2706,
          events: [
            {
              time: "08:00",
              title: "é«˜æ¾æ¸¯ â†’ åœŸåº„æ¸¯",
              desc: "æ­ä¹˜æ¸¡è¼ª (ç´„1H)",
              lat: 34.3524,
              lng: 134.052,
              icon: "boat",
            },
            {
              time: "09:30",
              title: "æ©„æ¬–å…¬åœ’",
              desc: "é­”å¥³å®…æ€¥ä¾¿æƒå¸šæ‹ç…§",
              lat: 34.4754,
              lng: 134.2947,
            },
            {
              time: "11:30",
              title: "é†¬ä¹‹é„‰",
              desc: "é†¬æ²¹éœœæ·‡æ·‹",
              lat: 34.4633,
              lng: 134.3317,
            },
            {
              time: "14:00",
              title: "å¤©ä½¿ä¹‹è·¯",
              desc: "é€€æ½®æ²™ç˜æ•£æ­¥",
              lat: 34.4746,
              lng: 134.1849,
            },
            {
              time: "16:00",
              title: "è¿”å›é«˜æ¾",
              desc: "æ­èˆ¹å›å¸‚å€",
              lat: 34.4827,
              lng: 134.1754,
              icon: "boat",
            },
          ],
          note: "è‹¥æµ·æ³ä¸ä½³ï¼ŒBè¨ˆç•«æ”¹å»ã€Œæ»¿æ¿ƒå…¬åœ’ã€ã€‚",
        },
        3: {
          title: "Day 3ï½œå½ˆæ€§é¸æ“‡æ—¥",
          date: "1/25 (æ—¥)",
          location: "Kotohira",
          lat: 34.1923,
          long: 133.8202,
          eventsMain: [
            {
              time: "09:00",
              title: "é‡‘åˆ€æ¯”ç¾…å®®",
              desc: "æŒ‘æˆ°1368éšæ¢¯ï¼Œåƒæ‹œç‹—ç‹—ç¥",
              lat: 34.1837,
              lng: 133.8122,
            },
            {
              time: "12:30",
              title: "å±±è¶Šçƒé¾éºµ",
              desc: "çƒé¾éºµååº—åˆé¤",
              lat: 34.2384,
              lng: 133.9213,
            },
            {
              time: "14:30",
              title: "æ»¿æ¿ƒå…¬åœ’",
              desc: "åœ‹ç‡Ÿå…¬åœ’è³èŠ±æ•£æ­¥",
              lat: 34.1678,
              lng: 133.8647,
            },
            {
              time: "18:00",
              title: "å¸‚å€æ™šé¤",
              desc: "è¿”å›é«˜æ¾",
              lat: 34.3428,
              lng: 134.0466,
            },
          ],
          eventsBackup: [
            {
              time: "09:00",
              title: "å‰å¾€ç”·æœ¨å³¶",
              desc: "é«˜æ¾æ¸¯æ­èˆ¹å‰å¾€",
              lat: 34.3524,
              lng: 134.052,
              icon: "boat",
            },
            {
              time: "10:00",
              title: "ç”·æœ¨å³¶ (è²“å³¶)",
              desc: "è±ç‰å§¬ç¥ç¤¾ã€æ“¼è²“æ•£æ­¥",
              lat: 34.4262,
              lng: 134.056,
            },
            {
              time: "13:00",
              title: "è¿”å›é«˜æ¾",
              desc: "å¸‚å€åˆé¤ & è³¼ç‰©",
              lat: 34.3428,
              lng: 134.0466,
            },
            {
              time: "15:00",
              title: "å®¤å…§è¡Œç¨‹",
              desc: "å•†åº—è¡— / å’–å•¡å»³ä¼‘æ¯",
              lat: 34.3444,
              lng: 134.0522,
            },
          ],
          note: "æ ¹æ“šç•¶å¤©é«”åŠ›å’Œå¤©æ°£ï¼Œè‡ªç”±åˆ‡æ›ä¸Šæ–¹æŒ‰éˆ•é¸æ“‡è¡Œç¨‹ï¼",
        },
        4: {
          title: "Day 4ï½œå€‰æ•·ä¸€æ—¥éŠ",
          date: "1/26 (ä¸€)",
          location: "Kurashiki",
          lat: 34.5951,
          long: 133.7667,
          events: [
            {
              time: "08:00",
              title: "å‰å¾€å€‰æ•·",
              desc: "è‡ªé§•/JR (ç€¨æˆ¶å¤§æ©‹)",
              lat: 34.5951,
              lng: 133.7667,
            },
            {
              time: "10:00",
              title: "å€‰æ•·ç¾è§€åœ°å€",
              desc: "é‹æ²³éŠèˆ¹ã€å¤è¡—æ•£æ­¥",
              lat: 34.5957,
              lng: 133.7712,
            },
            {
              time: "12:00",
              title: "å¤å¸‚çƒé¾éºµ",
              desc: "åˆé¤æ¨è–¦",
              lat: 34.5961,
              lng: 133.7692,
              link: "https://maps.app.goo.gl/6z3z3",
            },
            {
              time: "14:00",
              title: "èŒ¶å±‹å¤§æ©‹",
              desc: "æ°´æœè–ä»£ä¸‹åˆèŒ¶",
              lat: 34.5952,
              lng: 133.772,
            },
            {
              time: "17:00",
              title: "è¿”å›é«˜æ¾",
              desc: "è»Šç¨‹ç´„ 1.5 - 2 å°æ™‚",
              lat: 34.3428,
              lng: 134.0466,
            },
          ],
          note: "è¨˜å¾—ç•™è‚šå­åƒç”œé»ï¼",
        },
        5: {
          title: "Day 5ï½œè¿”ç¨‹æ—¥",
          date: "1/27 (äºŒ)",
          location: "Takamatsu",
          lat: 34.3428,
          long: 134.0466,
          events: [
            {
              time: "10:00",
              title: "ä¸¸é¾œç”º Green",
              desc: "æœ€å¾Œè¡åˆºè³¼ç‰©",
              lat: 34.3444,
              lng: 134.049,
            },
            {
              time: "11:30",
              title: "å››åœ‹æ°´æ—é¤¨",
              desc: "(é¸) é †è·¯å¯å»",
              lat: 34.3093,
              lng: 133.7997,
            },
            {
              time: "14:30",
              title: "å‰å¾€æ©Ÿå ´",
              desc: "åŠ æ²¹ã€é‚„è»Š",
              lat: 34.2142,
              lng: 134.0157,
            },
            {
              time: "18:55",
              title: "èµ·é£›è¿”å°",
              desc: "Bye Bye!",
              lat: 34.2142,
              lng: 134.0157,
              icon: "plane",
            },
          ],
          note: "æ°´æ—é¤¨è·Ÿæ©Ÿå ´ç®—é †è·¯ï¼Œä½†è¦æŠ“å¥½é‚„è»Šæ™‚é–“ã€‚",
        },
      };

      let currentDay3Mode = "main";

      function loadDay(day) {
        document
          .querySelectorAll(".tab-btn")
          .forEach((btn) => btn.classList.remove("active"));
        if (typeof day === "number") {
          document
            .querySelectorAll(".tab-btn")
            [day - 1].classList.add("active");
          updateExp(day);
          renderSchedule(day);
        } else {
          document.querySelectorAll(".tab-btn")[5].classList.add("active");
          updateExp(6);
          renderInfo();
        }
      }

      function renderSchedule(day) {
        const data = itinerary[day];
        const content = document.getElementById("mainContent");

        fetchWeatherDetailed(data.lat, data.long, data.location);

        let html = `
            <div class="weather-panel">
                <div class="weather-left">
                    <div class="weather-loc">ğŸ“ ${data.location} ${data.date}</div>
                    <div id="weatherDesc" class="weather-detail">è®€å–ä¸­...</div>
                </div>
                <div class="weather-right">
                    <span id="weatherIcon" class="weather-icon">ğŸ¤”</span>
                    <span id="weatherTemp" class="weather-temp">--Â°</span>
                </div>
            </div>

            <h2 style="margin:0 0 15px 0; color:#333; border-bottom:2px dashed #AAA; padding-bottom:5px;">
                ${data.title}
            </h2>
        `;

        if (day === 3) {
          html += `
                <div class="sub-nav-container">
                    <button class="sub-nav-btn ${
                      currentDay3Mode === "main" ? "active-main" : ""
                    }" onclick="switchDay3('main')">â˜€ ä¸»ç·šï¼šçˆ¬å±±</button>
                    <button class="sub-nav-btn ${
                      currentDay3Mode === "backup" ? "active-backup" : ""
                    }" onclick="switchDay3('backup')">â˜” å‚™æ¡ˆï¼šçœ‹è²“</button>
                </div>
                <div id="day3ListContainer"></div>
            `;
          setTimeout(() => renderDay3List(), 0);
        } else {
          html += generateListHtml(data.events);
        }

        if (data.note) {
          html += `<div class="npc-dialog">${data.note}</div>`;
        }

        content.innerHTML = html;
        window.scrollTo(0, 0);
      }

      function generateListHtml(events) {
        let listHtml = `<ul class="quest-list">`;
        events.forEach((event) => {
          let navUrl = `https://www.google.com/maps/dir/?api=1&destination=${event.lat},${event.lng}&travelmode=driving`;
          let infoBtn = event.link
            ? `<a href="${event.link}" target="_blank" class="btn btn-info">â„¹ï¸</a>`
            : "";

          let iconHtml = "";
          if (event.icon && ICONS[event.icon]) {
            iconHtml = `<img src="${
              ICONS[event.icon]
            }" class="event-icon-img">`;
          }

          listHtml += `
                <li class="quest-item">
                    <div class="quest-header">
                        <span class="quest-time">${event.time}</span>
                        <span class="quest-title">${event.title} ${iconHtml}</span>
                    </div>
                    <div class="quest-desc">${event.desc}</div>
                    <div style="display:flex;">
                        <a href="${navUrl}" target="_blank" class="btn btn-nav">ğŸš— å°èˆª GO</a>
                        ${infoBtn}
                    </div>
                </li>
            `;
        });
        listHtml += `</ul>`;
        return listHtml;
      }

      function switchDay3(mode) {
        currentDay3Mode = mode;
        const btns = document.querySelectorAll(".sub-nav-btn");
        btns[0].className = `sub-nav-btn ${
          mode === "main" ? "active-main" : ""
        }`;
        btns[1].className = `sub-nav-btn ${
          mode === "backup" ? "active-backup" : ""
        }`;
        renderDay3List();
      }

      function renderDay3List() {
        const container = document.getElementById("day3ListContainer");
        if (!container) return;
        const events =
          currentDay3Mode === "main"
            ? itinerary[3].eventsMain
            : itinerary[3].eventsBackup;
        container.innerHTML = generateListHtml(events);
      }

      function renderInfo() {
        document.getElementById("mainContent").innerHTML = `
            <div style="text-align:center; padding-top:20px;">
                <h2>ğŸ  FAV HOTEL TAKAMATSU</h2>
                <p>é«˜æ¾å¸‚ä¸­å¿ƒ</p>
                <a href="https://www.google.com/maps/search/?api=1&query=FAV+HOTEL+TAKAMATSU" target="_blank" class="btn btn-hotel">
                    ğŸ¨ å°èˆªå»é£¯åº—
                </a>
                <div class="npc-dialog">ç¥å¤§å®¶æ—…é€”æ„‰å¿«ï¼</div>
            </div>
        `;
      }

      function updateExp(day) {
        const pct = Math.round((day / 6) * 100);
        document.getElementById("expFill").style.width = pct + "%";
        document.getElementById("expText").innerText = pct + "%";
      }

      async function fetchWeatherDetailed(lat, long, loc) {
        const tEl = document.getElementById("weatherTemp");
        const dEl = document.getElementById("weatherDesc");
        const iEl = document.getElementById("weatherIcon");

        if (!tEl) return;
        tEl.innerText = "--";
        dEl.innerText = "è®€å–ä¸­...";
        iEl.innerText = "â³";

        try {
          const r = Math.random();
          const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${long}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Asia%2FTokyo&_r=${r}`;
          const res = await fetch(url);
          if (!res.ok) throw new Error("API Error");
          const data = await res.json();
          const current = data.current_weather;
          const daily = data.daily;
          const temp = Math.round(current.temperature);
          const max = Math.round(daily.temperature_2m_max[0]);
          const min = Math.round(daily.temperature_2m_min[0]);
          const rainProb = daily.precipitation_probability_max[0];
          const code = current.weathercode;

          let iconChar = "â˜€";
          let statusText = "æ™´æœ—";
          if (code >= 71 && code <= 77) {
            iconChar = "â„ï¸";
            statusText = "ä¸‹é›ª";
          } else if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) {
            iconChar = "ğŸŒ§";
            statusText = "æœ‰é›¨";
          } else if (code === 45 || code === 48) {
            iconChar = "ğŸŒ«";
            statusText = "æœ‰éœ§";
          } else if (code >= 1 && code <= 3) {
            iconChar = "â›…";
            statusText = "å¤šé›²";
          } else {
            iconChar = "â˜€";
            statusText = "æ™´æœ—";
          }

          tEl.innerText = `${temp}Â°`;
          iEl.innerText = iconChar;
          dEl.innerHTML = `${statusText} (é™é›¨ ${rainProb}%)<br>é«˜ ${max}Â° / ä½ ${min}Â°`;
        } catch (e) {
          tEl.innerText = "?";
          iEl.innerText = "âš ï¸";
          dEl.innerHTML = `ç„¡æ³•è®€å–<br><a href="https://www.google.com/search?q=weather+${loc}" target="_blank" class="weather-fallback-btn">ğŸ” Google å¤©æ°£</a>`;
        }
      }

      loadDay(1);
    </script>
  </body>
</html>
